<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reporte de Cierre Caja</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.4;
            color: #333;
            max-width: 100%;
            margin: 0;
            padding: 10px;
            font-size: 12px;
        }
        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
            margin: 10px 0;
        }
        .info-block {
            margin-bottom: 15px;
        }
        .info-block p {
            margin: 3px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            border: 1px solid black;
        }
        th, td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
            font-size: 11px;
        }
        th {
            background-color: #f2f2f2;
        }
        .totals {
            font-weight: bold;
        }
        .observation {
            background-color: #f9f9f9;
            padding: 8px;
            border-left: 3px solid #2c3e50;
        }
        .warning {
            color: #e74c3c;
            font-weight: bold;
        }
        #valor-faltante, #valor-faltante-calculado, #valor-total-efectivo {
            color: red;
            font-weight: bold;
        }
        #valor-excedente, #valor-excedente-calculado {
            color: green;
            font-weight: bold;
        }
        .dinero-info {
            text-align: left;
            margin-bottom: 15px;
        }
        .dinero-info h3 {
            text-align: left;
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <h1 id="titulo-reporte">REPORTE DE CIERRE CAJA</h1>

    <div class="info-block">
        <p id="nombre"><strong>Nombre:</strong></p>
        <p id="fecha-generacion"><strong>Generado:</strong></p>
        <p id="fecha-inicio"><strong>Desde:</strong></p>
        <p id="fecha-fin"><strong>Hasta:</strong></p>
        <p id="estado-caja"><strong>¿Cuadro Caja?:</strong></p>
        <p id="valor-faltante"><strong>Valor Faltante:</strong></p>
        <p id="valor-faltante-calculado"><strong>Valor Faltante Calculado:</strong></p>
        <p id="valor-excedente"><strong>Valor Excedente:</strong></p>
        <p id="valor-excedente-calculado"><strong>Valor Excedente Calculado:</strong></p>
        <p id="efectivo-apertura-cierre"><strong>Efectivo de Apertura y Cierre:</strong></p>
    </div>

    <table>
        <tr>
            <th>NOMBRES</th>
            <th>Apertura Cant 12 Onz licor</th>
            <th>Cierre Cant 12 Onz licor</th>
            <th>Apertura Cant 12 Onz sin licor</th>
            <th>Cierre Cant 12 Onz sin licor</th>
            <th>Apertura Cant 12 Onz cremoso</th>
            <th>Cierre Cant 12 Onz cremoso</th>
            <th>Apertura Cant 24 Onz</th>
            <th>Cierre Cant 24 Onz</th>
        </tr>
        <tr>
            <td>CANTIDADES</td>
            <td id="cant-ap-12-licor"></td>
            <td id="cant-ci-12-licor"></td>
            <td id="cant-ap-12-sin"></td>
            <td id="cant-ci-12-sin"></td>
            <td id="cant-ap-12-crem"></td>
            <td id="cant-ci-12-crem"></td>
            <td id="cant-ap-24"></td>
            <td id="cant-ci-24"></td>
        </tr>
        <tr>
            <td>DIFERENCIA</td>
            <td id="dif-12-licor" colspan="2"></td>
            <td id="dif-12-sin" colspan="2"></td>
            <td id="dif-12-crem" colspan="2"></td>
            <td id="dif-24" colspan="2"></td>
        </tr>
    </table>

    <div class="totals">
        <p id="total-12-onz">Total 12 Onz:</p>
        <p id="total-24-onz">Total 24 Onz:</p>
        <p id="total-efectivo-caja">Generado entre las fechas (Total de efectivo en caja):</p>
    </div>

    <h2 id="total-ventas">TOTAL DE VENTAS:</h2>

    <table>
        <tr>
            <th>CONCEPTO</th>
            <th>VALOR</th>
        </tr>
        <tr>
            <td>Efectivo Recibido:</td>
            <td id="valor-efectivo"></td>
        </tr>
        <tr>
            <td>Transferencias:</td>
            <td id="valor-transferencias"></td>
        </tr>
        <tr>
            <td>Tarjeta:</td>
            <td id="valor-tarjeta"></td>
        </tr>
        <tr>
            <td>Número de Ordenes Repartidas:</td>
            <td id="num-ordenes"></td>
        </tr>
        <tr>
            <td>Efectivo Repartido:</td>
            <td id="valor-efectivo-repartido"></td>
        </tr>
        <tr>
            <td>Transferencias Repartidas:</td>
            <td id="valor-transferencias-repartidas"></td>
        </tr>
        <tr>
            <td>Total de efectivo en caja - app:</td>
            <td id="valor-total-efectivo"></td>
        </tr>
        <tr>
            <td>Total de Transferencias:</td>
            <td id="valor-total-transferencias"></td>
        </tr>
    </table>

    <p id="advertencia" class="warning">
        Si el valor en ROJO es mayor que el VERDE quiere decir que hace falta efectivo en caja (posiblemente diste más cambio, o registraste algunas ventas como si te hubieran pagado en efectivo pero te las pagaron por transferencias u otros medios revisar bien.) así mismo con el total de transferencias.
    </p>

    <div class="observation">
        <h3 id="titulo-observaciones">Observaciones:</h3>
        <p id="obs-info"></p>
    </div>

    <div class="dinero-info">
        <h3 id="dinero-faltante">DINERO FALTANTE:</h3>
        <h3 id="dinero-excedente">DINERO EXEDENTE:</h3>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var params = new URLSearchParams(window.location.search);

            function setElementContent(id, paramName) {
                var element = document.getElementById(id);
                if (element) {
                    element.textContent += " " + (params.has(paramName) ? params.get(paramName) : "---");
                }
            }

            // Información general
            setElementContent("nombre", "nombre");
            setElementContent("fecha-generacion", "fechaGeneracion");
            setElementContent("fecha-inicio", "fechaInicio");
            setElementContent("fecha-fin", "fechaFin");
            setElementContent("estado-caja", "estadoCaja");
            setElementContent("valor-faltante", "valorFaltante");
            setElementContent("valor-faltante-calculado", "valorFaltanteCalculado");
            setElementContent("valor-excedente", "valorExcedente");
            setElementContent("valor-excedente-calculado", "valorExcedenteCalculado");
            setElementContent("efectivo-apertura-cierre", "efectivoAperturaCierre");

            // Cantidades
            setElementContent("cant-ap-12-licor", "cantAp12Licor");
            setElementContent("cant-ci-12-licor", "cantCi12Licor");
            setElementContent("cant-ap-12-sin", "cantAp12Sin");
            setElementContent("cant-ci-12-sin", "cantCi12Sin");
            setElementContent("cant-ap-12-crem", "cantAp12Crem");
            setElementContent("cant-ci-12-crem", "cantCi12Crem");
            setElementContent("cant-ap-24", "cantAp24");
            setElementContent("cant-ci-24", "cantCi24");

            // Diferencias
            setElementContent("dif-12-licor", "dif12Licor");
            setElementContent("dif-12-sin", "dif12Sin");
            setElementContent("dif-12-crem", "dif12Crem");
            setElementContent("dif-24", "dif24");

            // Totales
            setElementContent("total-12-onz", "total12Onz");
            setElementContent("total-24-onz", "total24Onz");
            setElementContent("total-efectivo-caja", "totalEfectivoCaja");
            setElementContent("total-ventas", "totalVentas");

            // Valores de la tabla
            setElementContent("valor-efectivo", "valorEfectivo");
            setElementContent("valor-transferencias", "valorTransferencias");
            setElementContent("valor-tarjeta", "valorTarjeta");
            setElementContent("num-ordenes", "numOrdenes");
            setElementContent("valor-efectivo-repartido", "valorEfectivoRepartido");
            setElementContent("valor-transferencias-repartidas", "valorTransferenciasRepartidas");
            setElementContent("valor-total-efectivo", "valorTotalEfectivo");
            setElementContent("valor-total-transferencias", "valorTotalTransferencias");

            // Observaciones
            setElementContent("obs-info", "obsinfo");

            // Dinero faltante y excedente
            setElementContent("dinero-faltante", "dineroFaltante");
            setElementContent("dinero-excedente", "dineroExcedente");

            // Función para formatear la fecha
            function formatearFecha(fechaStr) {
                const meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
                const fecha = new Date(fechaStr);
                return `${fecha.getDate()} de ${meses[fecha.getMonth()]} del ${fecha.getFullYear()}`;
            }

            // Obtener la fecha de inicio y formatearla
            const fechaInicio = params.get('fechaInicio');
            const fechaFormateada = fechaInicio ? formatearFecha(fechaInicio) : 'Fecha no disponible';

            // Configurar opciones para html2pdf
            var opt = {
                margin: 5,
                filename: `Cierre_y_apertura_${fechaFormateada}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // Generar y descargar el PDF
            html2pdf().set(opt).from(document.body).save().then(function() {
                console.log('PDF generado y descargado');
            });
        });
    </script>
</body>
</html>
